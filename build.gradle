allprojects {
    apply plugin: 'java'
    apply plugin: 'idea'

    group 'io.github.theblacksquidward'
    version SQUIDWARDBOT_VERSION

    repositories {
        mavenCentral()
        jcenter()
        maven {
            url 'https://m2.dv8tion.net/releases'
        }
        maven {
            url 'https://jitpack.io'
        }
    }

    dependencies {
        implementation 'org.jetbrains:annotations:23.0.0'
        implementation 'ch.qos.logback:logback-classic:1.4.4'
        implementation 'net.dv8tion:JDA:5.0.0-alpha.22'
        implementation 'org.reflections:reflections:0.10.2'
        implementation 'com.google.guava:guava:31.1-jre'
        implementation 'com.google.code.gson:gson:2.9.1'
        implementation 'net.sf.jopt-simple:jopt-simple:5.0.4'
        implementation 'org.apache.commons:commons-text:1.10.0'
    }
    compileJava.options.encoding = "UTF-8"

    tasks.withType(JavaCompile) {
        options.encoding = "UTF-8"
    }
}

configurations {
    moduleJar
}

dependencies {
    subprojects.each {
        moduleJar project(it.path)
        implementation project(it.path)
    }
}

task fatJar(type: Jar) {
    dependsOn configurations.moduleJar
    manifest {
        attributes(
                'Implementation-Title': 'SquidwardBot',
                'Implementation-Version': SQUIDWARDBOT_VERSION,
                'Main-Class': 'io.github.theblacksquidward.squidwardbot.Bootstrap'
        )
    }
    archiveName 'SquidwardBot.jar'
    duplicatesStrategy(DuplicatesStrategy.EXCLUDE)
    from {
        configurations.moduleJar.collect {
            zipTree(it)
        }
    }
    with jar
}